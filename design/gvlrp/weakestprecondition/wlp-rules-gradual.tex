\newcommand{\concrete}{\tsf{conc}}

\begin{spacing}{1.5} \begin{align*} \begin{mathleftalign}
\GWLP \ : \ \Statement \ \times \ \GFrmSatFormula \ \rightarrow \ \GFrmSatFormula \\
\GWLP(s, \tphi) := \
\text{match} \ s \ \text{with} \\
\begin{mathmatchwith}
  s_1 \code{;} \ s_2 &\mt&
    \GWLP(s_1, \ \GWLP(s_2, \ \tphi))
  \\
  % method call
  % TODO
  y \ \code{:=} \ z.m_C(\vec{e}) &\mt&
    \req{\vec{e}} \ \land \
    z \ \code{!=} \ \code{null} \ \land \\ &&
    \pre(z.m_C(\vec{e})) \ \ast \\ &&
    \tsf{handleMethodCall}(z.m_C(\vec{e}), \phi)
  \\
  \code{if} \ (e) \ \{ s_\text{the} \} \ \code{else} \ \{ s_\text{els} \} &\mt&
    \req{e} \ \land \\ &&
    \text{let} \
      \tphi_\text{the}, \ \tphi_\text{els} \ := \ \GWLP(s_\text{the}, \phi), \ \GWLP(s_\text{els}, \phi) \
    \text{in} \\ &&
    \text{match} \ \tphi_\text{the}, \ \tphi_\text{els} \ \text{with} \\ &&
    \begin{mathmatchwith}
      \phi_\text{the} \ \ast \ ?, \ \phi_\text{els} \ \ast \ ? && \\
      \phi_\text{the}, \ \phi_\text{els} \ \ast \ ? && \\
      \phi_\text{the} \ \ast \ ?, \ \phi_\text{els} &\mt&
        (\code{if} \ (e) \ \code{then} \ \phi_\text{the} \ \code{else} \ \phi_\text{els}) \ \ast \ ? \\
      \phi_\text{the}, \ \phi_\text{els} &\mt&
        \code{if} \ (e) \ \code{then} \ \phi_\text{the} \ \code{else} \ \phi_\text{els} \\
    \end{mathmatchwith}
  \\
  % TODO
  \code{while} \ (e) \ \code{invariant} \ \phi_\text{inv} \ \{ s_\text{bod} \} &\mt&
    \req{e} \ \land \
    \phi_\text{inv} \ \land \\ &&
      (\code{if} \ (e) \
      \code{then} \ \WLP(s_\text{bod}, \phi_\text{inv}) \
      \code{else} \ \code{true}) \ \ast \\ &&
    \tsf{handleWhileLoop}(e, \phi_\text{inv})
  \\
  \code{assert} \ \phi_\text{ass} &\mt&
    \req{\phi_\text{ass}} \ \land \
    \phi_\text{ass} \ \land \
    \phi
  \\
  \code{hold} \ \phi_\text{hol} \ \{ s_\text{bod} \} &\mt&
    \text{(unimplemented)} % UNIMPL
  \\
  \code{release} \ \phi_\text{rel} &\mt&
    \text{(unimplemented)} % UNIMPL
  \\
  % TODO
  \code{unfold} \ \alpha_C(\vec{e}) &\mt&
    \req{\alpha_C(\vec{e})} \ \land \\ &&
    [ \body(\alpha_C(\vec{e})) / \alpha_C(\vec{e}), \
      \phi\p / \cunfolding \ \alpha_C(\vec{e}) \ \cin \ \phi\p ]
    \phi
  \\
  % TODO
  \code{fold} \ \alpha_C(\vec{e}) &\mt&
    \req{\vec{e}} \ \land \
    [ \alpha_C(\vec{e}) / \body(\alpha_C(\vec{e})) ] \phi
  \\
  s &\mt&
    \text{match} \ \tphi \ \text{with} \\ &&
    \begin{mathmatchwith}
      \gphi &\mt& \WLP(s, \phi) \ \ast \ ? \\
      \phi  &\mt& \WLP(s, \phi)
    \end{mathmatchwith}
    % \WLP(s, \tphi)
  %
  \end{mathmatchwith}
\end{mathleftalign} \end{align*} \end{spacing}
